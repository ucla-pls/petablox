# Taint flow analysis

# Author: Joe Cox (cox@cs.ucla.edu)
# name=taintflow-dlog

.include "I.dom"
.include "M.dom"
.include "X.dom"
.include "Z.dom"

.bddvarorder I0xM0_X0xX1_Z0

###
# Relations
###

MXVarAsgnInst(m:M0,x1:X0,x2:X1) input
IinvkXArg(i:I0,z:Z0,x:X0) input
IinvkXRet(i:I0,z:Z0,x:X0) input
MmethXArg(m:M0,z:Z0,x:X0) input

taintSrc(m:M0) input

# untainted(x:X0) output
tainted(x:X0) output
tracked(m:M0) output

###
# Constraints
###

# Assignment: x = y;
# untainted(x) :- untainted(y), MXVarAsgnInst(_,x,y).
tainted(x) :- tainted(y), MXVarAsgnInst(_,x,y).

# Invocation
tainted(x) :- MmethXArg(m,z,x), IM(i,m), IinvkXArg(i,z,y), tainted(y).

# Return from tainted src
tainted(x) :- taintSrc(m), IinvkXRet(i,_,x), IM(i,m).
